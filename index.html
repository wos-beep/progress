<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[v1.5.2] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æˆé•·è¨˜éŒ² - å…µå£«æ•°é …ç›®æœ€é©åŒ–ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg-color: #121212; --card-bg: #1e1e1e; --text-color: #e0e0e0; --accent: #03dac6; --border: #333; }
        body { font-family: sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background: var(--bg-color); color: var(--text-color); }
        .card { background: var(--card-bg); padding: 20px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 20px; }
        .header-flex { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        .version-tag { font-size: 0.7em; color: #888; background: #333; padding: 2px 8px; border-radius: 4px; }
        h3 { margin-top: 0; color: var(--accent); border-left: 4px solid var(--accent); padding-left: 10px; }
        textarea { width: 100%; height: 80px; padding: 10px; background: #2c2c2c; color: #fff; border: 1px solid var(--border); border-radius: 8px; box-sizing: border-box; }
        input[type="date"], input[type="number"] { padding: 8px; background: #2c2c2c; color: #fff; border: 1px solid var(--border); border-radius: 4px; }
        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
        button { flex: 1; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-main { background: var(--accent); color: #000; }
        .btn-sub { background: #444; color: #fff; }
        .edit-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; background: #252525; padding: 15px; border-radius: 8px; margin-top: 10px; }
        .edit-item { display: flex; flex-direction: column; }
        .edit-item label { font-size: 10px; color: #aaa; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .history-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .history-table td { border-bottom: 1px solid #333; padding: 8px; }
        .canvas-container { position: relative; height: 500px; width: 100%; }
    </style>
</head>
<body>

    <div class="header-flex">
        <h2>ğŸ“ˆ Status Tracker <span class="version-tag">v1.5.1</span></h2>
        <div class="btn-group">
            <button class="btn-sub" onclick="exportData()" style="font-size:10px;">Export</button>
            <button class="btn-sub" onclick="document.getElementById('fileInput').click()" style="font-size:10px;">Import</button>
            <input type="file" id="fileInput" accept=".json" onchange="importData(event)">
        </div>
    </div>

    <div class="card">
        <h3>1. ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šè¾¼ã¿</h3>
        <div style="margin-bottom:10px;">æ—¥ä»˜: <input type="date" id="inputDate"></div>
        <textarea id="ocrInput" placeholder="ã‚³ãƒ”ãƒ¼ã—ãŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ†ã‚­ã‚¹ãƒˆã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„"></textarea>
        <button class="btn-main" style="width:100%; margin-top:10px;" onclick="parseText()">æ•°å€¤ã‚’æŠ½å‡ºã—ã¦ç¢ºèª</button>

        <div id="editArea" style="display:none; border-top: 1px solid #333; margin-top: 15px; padding-top: 10px;">
            <p style="font-size: 12px; color: #888; margin-bottom: 5px;">æŠ½å‡ºçµæœï¼ˆèª¤å­—ãŒã‚ã‚Œã°ä¿®æ­£ã—ã¦ãã ã•ã„ï¼‰ï¼š</p>
            <div id="statsGrid" class="edit-grid"></div>
            <div class="btn-group">
                <button class="btn-main" onclick="saveToStorage()">ã“ã®å†…å®¹ã§çµ±åˆä¿å­˜</button>
                <button class="btn-sub" onclick="document.getElementById('editArea').style.display='none'">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>
    
    <div class="card">
        <h3>2. æˆé•·æ¨ç§»ï¼ˆå·¦å³2è»¸ï¼‰</h3>
        <div class="canvas-container">
            <canvas id="growthChart"></canvas>
        </div>
    </div>

    <div class="card">
        <h3>3. å±¥æ­´ç®¡ç†</h3>
        <div id="historyList"></div>
    </div>

    <script>
        let myChart;
        const storageKey = 'game_stats_v1.2.0'; 
        
        // å…µå£«æ•°é …ç›®ã‚’ãƒªã‚¹ãƒˆåŒ–
        const soldierStats = ["çƒˆæ—¥ç›¾å…µ", "çƒˆæ—¥æ§å…µ", "çƒˆæ—¥å¼“å…µ", "åˆ‡ã‚Šæœ­ç›¾å…µ", "åˆ‡ã‚Šæœ­æ§å…µ", "åˆ‡ã‚Šæœ­å¼“å…µ"];
        // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆé …ç›®ã‚’ãƒªã‚¹ãƒˆåŒ–
        const percentStats = ["éƒ¨éšŠæ”»æ’ƒåŠ›", "éƒ¨éšŠé˜²å¾¡åŠ›", "éƒ¨éšŠHP", "ç›¾å…µæ”»æ’ƒåŠ›", "ç›¾å…µé˜²å¾¡åŠ›", "ç›¾å…µHP", "æ§å…µæ”»æ’ƒåŠ›", "å¼“å…µæ”»æ’ƒåŠ›", "å‡ºå¾é€Ÿåº¦ãƒœãƒ¼ãƒŠã‚¹"];
        
        // å…¨è¡¨ç¤ºã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
        const displayTargets = [...percentStats, ...soldierStats];

        window.onload = () => {
            document.getElementById('inputDate').valueAsDate = new Date();
            updateChart();
            renderHistory();
        };

        function parseText() {
            const text = document.getElementById('ocrInput').value;
            if (!text) return;
            const values = text.match(/[\d,.]+/g) || [];
            // è‹±å­—ãƒ»æ¼¢å­—ãƒ»ã‚«ã‚¿ã‚«ãƒŠãƒ»é•·éŸ³ã‚’è¨±å¯
            const labels = text.match(/[ä¸€-é¾ ã-ã‚“ã‚¡-ãƒ¶ãƒ¼A-Za-z]{2,}/g) || [];
            const grid = document.getElementById('statsGrid');
            grid.innerHTML = '';
            labels.forEach((label, i) => {
                if (values[i]) {
                    const val = values[i].replace(/,/g, '');
                    const item = document.createElement('div');
                    item.className = 'edit-item';
                    item.innerHTML = `<label title="${label}">${label}</label><input type="number" step="0.01" class="stat-input" data-label="${label}" value="${val}">`;
                    grid.appendChild(item);
                }
            });
            document.getElementById('editArea').style.display = 'block';
        }

        function saveToStorage() {
            const date = document.getElementById('inputDate').value;
            const inputs = document.querySelectorAll('.stat-input');
            const newStats = {};
            inputs.forEach(input => { newStats[input.dataset.label] = parseFloat(input.value); });
            const rawData = localStorage.getItem(storageKey);
            let history = rawData ? JSON.parse(rawData) : [];
            const idx = history.findIndex(d => d.date === date);
            if (idx > -1) { history[idx].stats = Object.assign({}, history[idx].stats, newStats); }
            else { history.push({ date, stats: newStats }); }
            history.sort((a, b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem(storageKey, JSON.stringify(history));
            document.getElementById('editArea').style.display = 'none';
            document.getElementById('ocrInput').value = '';
            updateChart();
            renderHistory();
        }

        function updateChart() {
            const rawData = localStorage.getItem(storageKey);
            if (!rawData) return;
            const history = JSON.parse(rawData);
            const labels = history.map(d => d.date);
            
            // ã‚«ãƒ©ãƒ•ãƒ«ãª20è‰²ã‚»ãƒƒãƒˆï¼ˆé …ç›®ãŒå¤šãã¦ã‚‚è¢«ã‚Šã«ãã„ï¼‰
            const colors = [
                '#03dac6', '#bb86fc', '#ff0266', '#ffde03', '#03a9f4', '#4caf50', '#ff9800', '#f44336', 
                '#9c27b0', '#795548', '#607d8b', '#e91e63', '#1abc9c', '#2ecc71', '#3498db', '#9b59b6'
            ];

            const datasets = displayTargets.map((target, i) => {
                const isSoldier = soldierStats.includes(target);
                return {
                    label: target,
                    data: history.map(d => (d.stats && d.stats[target] !== undefined) ? d.stats[target] : null),
                    borderColor: colors[i % colors.length],
                    backgroundColor: colors[i % colors.length],
                    yAxisID: isSoldier ? 'y1' : 'y', // å…µå£«æ•°ãªã‚‰å³è»¸
                    tension: 0.2,
                    spanGaps: true,
                    borderWidth: isSoldier ? 3 : 2, // å…µå£«æ•°ã‚’å°‘ã—å¤ªãã—ã¦åŒºåˆ¥
                    borderDash: isSoldier ? [5, 2] : [] // å…µå£«æ•°ã‚’ç‚¹ç·šã«ã™ã‚‹ï¼ˆä»»æ„ï¼‰
                };
            });

            const ctx = document.getElementById('growthChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#aaa', font: { size: 9 }, boxWidth: 8, padding: 10 }
                        },
                        tooltip: { backgroundColor: 'rgba(0,0,0,0.8)', titleFont: { size: 14 } }
                    },
                    scales: { 
                        x: { ticks: { color: '#aaa' }, grid: { color: '#333' } },
                        y: { 
                            type: 'linear', position: 'left',
                            ticks: { color: '#03dac6', callback: v => v + '%' },
                            grid: { color: '#333' },
                            title: { display: true, text: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (%)', color: '#03dac6' }
                        },
                        y1: {
                            type: 'linear', position: 'right',
                            grid: { drawOnChartArea: false },
                            ticks: { color: '#bb86fc', callback: v => v.toLocaleString() },
                            title: { display: true, text: 'å…µå£«æ•° (å®Ÿæ•°)', color: '#bb86fc' }
                        }
                    }
                }
            });
        }

        function renderHistory() {
            const history = JSON.parse(localStorage.getItem(storageKey) || "[]");
            let html = `<table class="history-table">`;
            history.forEach((entry, i) => {
                html += `<tr><td>${entry.date}</td><td>${Object.keys(entry.stats).length}é …ç›®</td>
                    <td style="text-align:right;"><button onclick="editHistory(${i})" style="background:#03a9f4; padding:3px 7px; font-size:10px; width:auto;">ä¿®æ­£</button></td></tr>`;
            });
            document.getElementById('historyList').innerHTML = html + `</table>`;
        }

        function editHistory(index) {
            const history = JSON.parse(localStorage.getItem(storageKey));
            const entry = history[index];
            document.getElementById('inputDate').value = entry.date;
            const grid = document.getElementById('statsGrid');
            grid.innerHTML = '';
            for (let label in entry.stats) {
                grid.innerHTML += `<div class="edit-item"><label>${label}</label><input type="number" step="0.01" class="stat-input" data-label="${label}" value="${entry.stats[label]}"></div>`;
            }
            document.getElementById('editArea').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function exportData() {
            const data = localStorage.getItem(storageKey);
            if (!data) return;
            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([data], { type: 'application/json' }));
            a.download = `status_tracker_v151.json`;
            a.click();
        }

        function importData(e) {
            const r = new FileReader();
            r.onload = (ev) => { localStorage.setItem(storageKey, ev.target.result); location.reload(); };
            r.readAsText(e.target.files[0]);
        }
    </script>
</body>
</html>

