<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[v1.4.0] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æˆé•·è¨˜éŒ² - Dark Mode</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --primary: #3700b3;
            --accent: #03dac6;
            --danger: #cf6679;
            --border: #333;
        }
        body { font-family: sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background: var(--bg-color); color: var(--text-color); line-height: 1.6; }
        .card { background: var(--card-bg); padding: 20px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 4px 10px rgba(0,0,0,0.3); margin-bottom: 20px; }
        .header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 10px; }
        .version-tag { font-size: 0.7em; color: #888; background: #333; padding: 2px 8px; border-radius: 4px; }
        h2, h3 { margin-top: 0; color: var(--accent); }
        textarea { width: 100%; height: 100px; padding: 10px; background: #2c2c2c; color: #fff; border: 1px solid var(--border); border-radius: 8px; box-sizing: border-box; }
        input[type="date"], input[type="number"] { padding: 8px; background: #2c2c2c; color: #fff; border: 1px solid var(--border); border-radius: 4px; }
        
        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
        button { flex: 1; min-width: 100px; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-main { background: var(--accent); color: #000; }
        .btn-sub { background: #444; color: #fff; }
        .btn-danger { background: var(--danger); color: #000; }
        button:hover { filter: brightness(1.2); }

        .edit-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; background: #252525; padding: 15px; border-radius: 8px; }
        .edit-item { display: flex; flex-direction: column; }
        .edit-item label { font-size: 11px; color: #aaa; margin-bottom: 2px; }

        .history-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        .history-table th, .history-table td { border-bottom: 1px solid #333; padding: 10px; text-align: left; }
        .history-table tr:hover { background: #252525; }

        .canvas-container { position: relative; height: 400px; width: 100%; margin-top: 10px; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

    <div class="header-flex">
        <h2>ğŸ“ˆ Status Tracker <span class="version-tag">v1.4.0</span></h2>
        <div class="btn-group" style="margin-top:0;">
            <button class="btn-sub" onclick="exportData()" style="font-size:11px;">ğŸ“¤ Export</button>
            <button class="btn-sub" onclick="document.getElementById('fileInput').click()" style="font-size:11px;">ğŸ“¥ Import</button>
            <input type="file" id="fileInput" accept=".json" onchange="importData(event)">
        </div>
    </div>

    <div class="card">
        <h3>1. ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šè¾¼ã¿</h3>
        <div style="margin-bottom:15px;">
            æ—¥ä»˜: <input type="date" id="inputDate">
        </div>
        <textarea id="ocrInput" placeholder="Pixelã®ã‚³ãƒ”ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘"></textarea>
        <div class="btn-group">
            <button class="btn-main" onclick="parseText()">è§£æãƒ»ä¿®æ­£ã—ã¦ä¿å­˜</button>
        </div>

        <div id="editArea" style="display:none; border-top: 1px solid #333; margin-top: 20px; padding-top: 10px;">
            <div id="statsGrid" class="edit-grid"></div>
            <div class="btn-group">
                <button class="btn-main" onclick="saveToStorage()">çµ±åˆä¿å­˜</button>
                <button class="btn-sub" onclick="document.getElementById('editArea').style.display='none'">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>2. æˆé•·æ¨ç§»ã‚°ãƒ©ãƒ•</h3>
        <div class="canvas-container">
            <canvas id="growthChart"></canvas>
        </div>
    </div>

    <div class="card">
        <h3>3. å±¥æ­´ã®ç®¡ç†ãƒ»æ‰‹å‹•ä¿®æ­£</h3>
        <div id="historyList">
            </div>
    </div>

    <div style="text-align: center; margin-bottom: 50px;">
        <button class="btn-danger" style="width: auto; padding: 5px 20px; font-size: 11px;" onclick="clearData()">å…¨ãƒ‡ãƒ¼ã‚¿æ¶ˆå»</button>
    </div>

    <script>
        let myChart;
        const storageKey = 'game_stats_v1.2.0'; 
        const displayTargets = ["éƒ¨éšŠæ”»æ’ƒåŠ›", "éƒ¨éšŠé˜²å¾¡åŠ›", "éƒ¨éšŠHP", "ç›¾å…µæ”»æ’ƒåŠ›", "ç›¾å…µé˜²å¾¡åŠ›", "ç›¾å…µHP", "æ§å…µæ”»æ’ƒåŠ›", "å¼“å…µæ”»æ’ƒåŠ›", "å‡ºå¾é€Ÿåº¦ãƒœãƒ¼ãƒŠã‚¹"];

        window.onload = () => {
            document.getElementById('inputDate').valueAsDate = new Date();
            updateChart();
            renderHistory();
        };

        function parseText() {
            const text = document.getElementById('ocrInput').value;
            if (!text) return;
            const values = text.match(/[\d,.]+(?=%|)/g) || [];
            const labels = text.match(/[ä¸€-é¾ ã-ã‚“ã‚¡-ãƒ¶ãƒ¼A-Za-z]{2,}/g) || [];
            const grid = document.getElementById('statsGrid');
            grid.innerHTML = '';
            labels.forEach((label, i) => {
                if (values[i]) {
                    const val = values[i].replace(/,/g, '');
                    const item = document.createElement('div');
                    item.className = 'edit-item';
                    item.innerHTML = `<label>${label}</label><input type="number" step="0.01" class="stat-input" data-label="${label}" value="${val}">`;
                    grid.appendChild(item);
                }
            });
            document.getElementById('editArea').style.display = 'block';
        }

        function saveToStorage() {
            const date = document.getElementById('inputDate').value;
            const inputs = document.querySelectorAll('.stat-input');
            const newStats = {};
            inputs.forEach(input => { newStats[input.dataset.label] = parseFloat(input.value); });
            const rawData = localStorage.getItem(storageKey);
            let history = rawData ? JSON.parse(rawData) : [];
            const idx = history.findIndex(d => d.date === date);
            if (idx > -1) { history[idx].stats = Object.assign({}, history[idx].stats, newStats); }
            else { history.push({ date, stats: newStats }); }
            history.sort((a, b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem(storageKey, JSON.stringify(history));
            document.getElementById('editArea').style.display = 'none';
            document.getElementById('ocrInput').value = '';
            updateChart();
            renderHistory();
        }

        // --- å±¥æ­´è¡¨ç¤ºãƒ»ç·¨é›†æ©Ÿèƒ½ ---
        function renderHistory() {
            const rawData = localStorage.getItem(storageKey);
            if (!rawData) return;
            const history = JSON.parse(rawData);
            let html = `<table class="history-table"><tr><th>æ—¥ä»˜</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ•°</th><th>æ“ä½œ</th></tr>`;
            history.forEach((entry, i) => {
                html += `<tr>
                    <td>${entry.date}</td>
                    <td>${Object.keys(entry.stats).length}é …ç›®</td>
                    <td>
                        <button onclick="editHistory(${i})" style="padding:4px 8px; font-size:11px; width:auto; background:#03a9f4; color:#fff;">ä¿®æ­£</button>
                        <button onclick="deleteHistory(${i})" style="padding:4px 8px; font-size:11px; width:auto; background:#f44336; color:#fff;">å‰Šé™¤</button>
                    </td>
                </tr>`;
            });
            html += `</table>`;
            document.getElementById('historyList').innerHTML = html;
        }

        function editHistory(index) {
            const history = JSON.parse(localStorage.getItem(storageKey));
            const entry = history[index];
            document.getElementById('inputDate').value = entry.date;
            
            const grid = document.getElementById('statsGrid');
            grid.innerHTML = '';
            for (let label in entry.stats) {
                const item = document.createElement('div');
                item.className = 'edit-item';
                item.innerHTML = `<label>${label}</label><input type="number" step="0.01" class="stat-input" data-label="${label}" value="${entry.stats[label]}">`;
                grid.appendChild(item);
            }
            document.getElementById('editArea').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteHistory(index) {
            if (confirm("ã“ã®æ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
                let history = JSON.parse(localStorage.getItem(storageKey));
                history.splice(index, 1);
                localStorage.setItem(storageKey, JSON.stringify(history));
                updateChart();
                renderHistory();
            }
        }

        // --- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆ ---
        function exportData() {
            const data = localStorage.getItem(storageKey);
            if (!data) return alert("ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");
            const blob = new Blob([data], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `status_tracker_backup.json`;
            a.click();
        }

        function importData(event) {
            const reader = new FileReader();
            reader.onload = (e) => {
                localStorage.setItem(storageKey, e.target.result);
                location.reload();
            };
            reader.readAsText(event.target.files[0]);
        }

        function updateChart() {
            const rawData = localStorage.getItem(storageKey);
            if (!rawData) return;
            const history = JSON.parse(rawData);
            const labels = history.map(d => d.date);
            const colors = ['#03dac6', '#bb86fc', '#ff0266', '#ffde03', '#03a9f4', '#4caf50', '#ff9800', '#f44336'];
            const datasets = displayTargets.map((target, i) => ({
                label: target,
                data: history.map(d => d.stats[target] || null),
                borderColor: colors[i % colors.length],
                tension: 0.2,
                spanGaps: true
            }));
            const ctx = document.getElementById('growthChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#aaa', font: { size: 10 } } } },
                    scales: { 
                        x: { ticks: { color: '#aaa' }, grid: { color: '#333' } },
                        y: { ticks: { color: '#aaa', callback: v => v + '%' }, grid: { color: '#333' } }
                    }
                }
            });
        }

        function clearData() {
            if(confirm("å…¨æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ")) { localStorage.removeItem(storageKey); location.reload(); }
        }
    </script>
</body>
</html>
