<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æˆé•·è¨˜éŒ²</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f4f7f9; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        textarea { width: 100%; height: 100px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .canvas-container { position: relative; height: 40vh; width: 100%; }
    </style>
</head>
<body>

    <h2>ğŸ“ˆ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æˆé•·æ¨ç§»</h2>

    <div class="card">
        <h3>1. ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ </h3>
        <p>æ—¥ä»˜: <input type="date" id="inputDate"></p>
        <p>OCRã®ã‚³ãƒ”ãƒ¼ã‚’è²¼ã‚Šä»˜ã‘:</p>
        <textarea id="ocrInput" placeholder="ä¾‹: ç›¾å…µæ”»æ’ƒåŠ› 488.25%&#10;ç›¾å…µé˜²å¾¡åŠ› 521.25%"></textarea>
        <button onclick="saveData()">ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦æ›´æ–°</button>
        <button onclick="clearData()" style="background:#dc3545;">ãƒ‡ãƒ¼ã‚¿å…¨æ¶ˆå»</button>
    </div>

    <div class="card">
        <h3>2. æ¨ç§»ã‚°ãƒ©ãƒ•</h3>
        <div class="canvas-container">
            <canvas id="growthChart"></canvas>
        </div>
    </div>

    <script>
        let myChart;
        const storageKey = 'game_stats_data';

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        window.onload = () => {
            document.getElementById('inputDate').valueAsDate = new Date();
            updateChart();
        };

        // ãƒ‡ãƒ¼ã‚¿ã®æŠ½å‡ºã¨ä¿å­˜
        function saveData() {
            const date = document.getElementById('inputDate').value;
            const text = document.getElementById('ocrInput').value;
            if (!text) return alert("ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

            // æ­£è¦è¡¨ç¾ã§ã€Œé …ç›®åã€ã¨ã€Œæ•°å€¤ã€ã‚’æŠ½å‡º
            const stats = {};
            const lines = text.split('\n');
            lines.forEach(line => {
                // ã€Œé …ç›®åã€ã¨ã€Œæ•°å€¤ï¼ˆå°æ•°ç‚¹å«ã‚€ï¼‰ã€ã‚’æŠ½å‡ºã™ã‚‹æ­£è¦è¡¨ç¾
                const match = line.match(/([^\d%]+)\s*([\d.]+)/);
                if (match) {
                    const label = match[1].trim();
                    const value = parseFloat(match[2]);
                    stats[label] = value;
                }
            });

            if (Object.keys(stats).length === 0) return alert("æ•°å€¤ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ");

            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const rawData = localStorage.getItem(storageKey);
            const history = rawData ? JSON.parse(rawData) : [];
            
            // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
            history.push({ date, stats });
            // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ
            history.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            localStorage.setItem(storageKey, JSON.stringify(history));
            alert("ä¿å­˜ã—ã¾ã—ãŸï¼");
            updateChart();
        }

        // ã‚°ãƒ©ãƒ•ã®æ›´æ–°
        function updateChart() {
            const rawData = localStorage.getItem(storageKey);
            if (!rawData) return;
            const history = JSON.parse(rawData);

            const labels = history.map(d => d.date);
            
            // æŠ½å‡ºã—ãŸã„é …ç›®ãƒªã‚¹ãƒˆï¼ˆç”»åƒã«åˆã‚ã›ã¦èª¿æ•´ï¼‰
            const targetStats = ["ç›¾å…µæ”»æ’ƒåŠ›", "ç›¾å…µé˜²å¾¡åŠ›", "ç›¾å…µHP"];
            const colors = ['#ff6384', '#36a2eb', '#4bc0c0'];

            const datasets = targetStats.map((label, i) => ({
                label: label,
                data: history.map(d => d.stats[label] || null),
                borderColor: colors[i],
                fill: false,
                tension: 0.1
            }));

            const ctx = document.getElementById('growthChart').getContext('2d');
            
            if (myChart) myChart.destroy(); // æ—¢å­˜ã®ã‚°ãƒ©ãƒ•ã‚’ç ´æ£„

            myChart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: false } }
                }
            });
        }

        function clearData() {
            if(confirm("å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
                localStorage.removeItem(storageKey);
                location.reload();
            }
        }
    </script>
</body>
</html>